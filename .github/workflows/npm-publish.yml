name: Publish Package To NPM

on:
  workflow_run:
    workflows:
      - Node.js CI
    types:
      - completed

jobs:
 publish:
   runs-on: ubuntu-latest
   permissions:
     contents: read
     packages: write
     id-token: write
   steps:
     # Step 1: Checkout the repository
     - name: Checkout repository
       uses: actions/checkout@v4
     # Step 2: Set up Node.js environment
     - name: Set up Node.js
       uses: actions/setup-node@v4
       with:
         node-version: '20.x'
         registry-url: 'https://registry.npmjs.org'
     # Step 3: Install dependencies
     - name: Install dependencies
       run: npm ci
     # Step 4: Publish to npm registry
     - name: Publish to npm
       run: npm publish --provenance --access public
       env:
         NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
     # Step 5: Publish to GitHub Packages
     - name: Publish to GitHub Packages
       uses: actions/setup-node@v4
       with:
         node-version: '20.x'
         registry-url: 'https://npm.pkg.github.com'
         scope: '@events-broadcast'
         run: npm publish
       env:
         NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}